<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mirror Maze â€” Vivk Ai Game</title>
<style>
  :root{--bg:#071025;--panel:#0b1220;--accent:#06b6d4}
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;font-family:Inter,system-ui,-apple-system,"Cairo",sans-serif;background:linear-gradient(180deg,var(--bg),#051021);color:#e6eef8}
  .wrap{max-width:1100px;margin:24px auto;padding:18px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  h1{font-size:1.15rem}
  #game{display:flex;gap:12px;align-items:flex-start}
  canvas{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  #left,#right{width:520px;height:520px}
  .controls{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
  .btn{background:var(--panel);padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .info{font-size:0.95rem;color:rgba(230,238,248,0.85)}
  .small{font-size:0.85rem;color:rgba(230,238,248,0.7)}
  footer{margin-top:12px;color:rgba(230,238,248,0.6);font-size:0.85rem}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Mirror Maze â€” Vivk Ai</h1>
      <div class="small">ØªØ­ÙƒÙ…: Ø£Ø³Ù‡Ù… Ø£Ùˆ WASD â€” Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ ØªØªØ­Ø±Ùƒ Ù…Ø±Ø¢Ø© Ø£ÙÙ‚ÙŠØ©.</div>
    </div>
    <div class="info">
      Ù…Ø³ØªÙˆÙ‰: <span id="level">1</span> &nbsp;|&nbsp; Ù…ÙØ§ØªÙŠØ­: <span id="keys">0</span>/<span id="need">1</span>
    </div>
  </header>

  <div id="game">
    <canvas id="left" width="520" height="520"></canvas>
    <canvas id="right" width="520" height="520"></canvas>
  </div>

  <div class="controls">
    <button class="btn" id="restart">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ØªÙˆÙ‰</button>
    <button class="btn" id="next" title="Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ÙÙˆØ²">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</button>
    <div class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: ÙƒÙ„ Ø¹Ù‚Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù‡Ø§ Ù…Ø±Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†.</div>
  </div>

  <footer>Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© â€” Ø¥Ù† Ø£Ø±Ø¯Øª Ø£Ø·ÙˆØ±Ù‡Ø§: Ù…Ø¤Ø«Ø±Ø§Øª ØµÙˆØªÙŠØ©ØŒ ØªØ®Ø²ÙŠÙ† Ù†Ù‚Ø§Ø·ØŒ ÙˆÙ…Ø±Ø§Ø­Ù„ Ø¥Ø¶Ø§ÙÙŠØ©.</footer>
</div>

<script>
(() => {
  const left = document.getElementById('left');
  const right = document.getElementById('right');
  const L = left.getContext('2d');
  const R = right.getContext('2d');
  const W = 520, H = 520;
  const cell = 40; // grid cell
  const cols = Math.floor(W / cell);
  const rows = Math.floor(H / cell);

  let level = 1;
  let needKeys = 1;
  let keysCollected = 0;

  const $level = document.getElementById('level');
  const $keys = document.getElementById('keys');
  const $need = document.getElementById('need');

  function rndInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}

  // Game state
  let gridLeft, playerLeft, playerRight, goalLeft, goalRight;

  function initLevel(l) {
    // grid: 0 empty, 1 wall, 2 key
    gridLeft = Array(rows).fill(0).map(()=>Array(cols).fill(0));
    keysCollected = 0;
    needKeys = Math.min(1 + Math.floor(l/2), 4);
    // place random walls based on level
    let wallCount = Math.min(18 + l*6, rows*cols*0.3);
    for (let i=0;i<wallCount;i++){
      let r = rndInt(1, rows-2), c = rndInt(1, cols-2);
      if ((r===1 && c===1) || (r===rows-2 && c===cols-2)) continue;
      gridLeft[r][c] = 1;
    }
    // place keys
    let placed = 0;
    while (placed < needKeys) {
      let r = rndInt(1, rows-2), c = rndInt(1, cols-2);
      if (gridLeft[r][c]===0) { gridLeft[r][c]=2; placed++; }
    }
    // player positions: top-left and bottom-right mirror
    playerLeft = {r:1, c:1};
    playerRight = mirrorCoord(playerLeft);
    goalLeft = {r: rows-2, c: cols-2};
    goalRight = mirrorCoord(goalLeft);
    updateUI();
    draw();
  }

  function mirrorCoord(p){ // mirror horizontally across center line
    return {r: p.r, c: cols-1 - p.c};
  }

  function drawGrid(ctx, grid, player, goal, mirrored=false){
    ctx.clearRect(0,0,W,H);
    // background
    ctx.fillStyle = '#071025';
    ctx.fillRect(0,0,W,H);
    // draw cells
    for (let r=0;r<rows;r++){
      for (let c=0;c<cols;c++){
        const x = c*cell, y = r*cell;
        // tile background
        ctx.fillStyle = 'rgba(255,255,255,0.02)';
        ctx.fillRect(x+1,y+1,cell-2,cell-2);
        if (grid[r][c]===1) {
          ctx.fillStyle = '#ff6b6b';
          ctx.fillRect(x+4,y+4,cell-8,cell-8);
        } else if (grid[r][c]===2) {
          // key
          ctx.fillStyle = '#ffd166';
          ctx.beginPath();
          ctx.arc(x+cell/2, y+cell/2, cell*0.22, 0, Math.PI*2);
          ctx.fill();
        }
      }
    }
    // draw goal
    ctx.fillStyle = '#7fffd4';
    ctx.fillRect(goal.c*cell+8, goal.r*cell+8, cell-16, cell-16);
    // draw player
    ctx.fillStyle = '#06b6d4';
    ctx.beginPath();
    ctx.arc(player.c*cell + cell/2, player.r*cell + cell/2, cell*0.30, 0, Math.PI*2);
    ctx.fill();
    // grid lines subtle
    ctx.strokeStyle = 'rgba(255,255,255,0.03)';
    for (let i=0;i<=cols;i++){
      ctx.beginPath(); ctx.moveTo(i*cell,0); ctx.lineTo(i*cell,H); ctx.stroke();
    }
    for (let i=0;i<=rows;i++){
      ctx.beginPath(); ctx.moveTo(0,i*cell); ctx.lineTo(W,i*cell); ctx.stroke();
    }
    // mirrored label
    ctx.fillStyle = 'rgba(255,255,255,0.06)';
    ctx.font = '14px Cairo';
    ctx.fillText(mirrored ? 'Ø§Ù„Ù…Ø±Ø¢Ø©' : 'Ø§Ù„Ø¬Ø§Ù†Ø¨', 8, 18);
  }

  function draw(){
    drawGrid(L, gridLeft, playerLeft, goalLeft, false);
    // create mirrored grid for right view
    // mirror the left grid horizontally
    const gridRight = gridLeft.map(row => row.slice().reverse());
    drawGrid(R, gridRight, playerRight, goalRight, true);
  }

  function updateUI(){
    $level.innerText = level;
    $keys.innerText = keysCollected;
    $need.innerText = needKeys;
  }

  function tryMove(dr, dc){
    const nr = playerLeft.r + dr;
    const nc = playerLeft.c + dc;
    if (nr<0 || nr>=rows || nc<0 || nc>=cols) return;
    if (gridLeft[nr][nc]===1) return; // wall
    // move left player
    playerLeft.r = nr; playerLeft.c = nc;
    // update right player as mirror
    playerRight = mirrorCoord(playerLeft);
    // collect key?
    if (gridLeft[nr][nc]===2){
      gridLeft[nr][nc]=0;
      keysCollected++;
    }
    updateUI();
    draw();
    checkWin();
  }

  function checkWin(){
    if (playerLeft.r===goalLeft.r && playerLeft.c===goalLeft.c &&
        playerRight.r===goalRight.r && playerRight.c===goalRight.c &&
        keysCollected >= needKeys){
      // win!
      setTimeout(()=>{
        alert('Ù…Ù…ØªØ§Ø²! Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ' + level + ' ğŸ‰');
      }, 100);
    }
  }

  // controls
  window.addEventListener('keydown', e=>{
    const k = e.key;
    if (k==='ArrowUp' || k==='w' || k==='W') tryMove(-1,0);
    else if (k==='ArrowDown' || k==='s' || k==='S') tryMove(1,0);
    else if (k==='ArrowLeft' || k==='a' || k==='A') tryMove(0,-1);
    else if (k==='ArrowRight' || k==='d' || k==='D') tryMove(0,1);
    else if (k==='r' || k==='R') initLevel(level);
  });

  document.getElementById('restart').addEventListener('click', ()=> initLevel(level));
  document.getElementById('next').addEventListener('click', ()=>{
    level++;
    initLevel(level);
  });

  // initialize
  initLevel(level);
})();
</script>
</body>
</html>